table:
  name: matches
  schema: public
object_relationships:
  - name: e_match_status
    using:
      foreign_key_constraint_on: status
  - name: lineup_1
    using:
      foreign_key_constraint_on: lineup_1_id
  - name: lineup_2
    using:
      foreign_key_constraint_on: lineup_2_id
  - name: options
    using:
      foreign_key_constraint_on: match_options_id
  - name: organizer
    using:
      manual_configuration:
        column_mapping:
          organizer_steam_id: steam_id
        insertion_order: null
        remote_table:
          name: players
          schema: public
  - name: server
    using:
      foreign_key_constraint_on: server_id
  - name: winner
    using:
      manual_configuration:
        column_mapping:
          winning_lineup_id: id
        insertion_order: null
        remote_table:
          name: match_lineups
          schema: public
array_relationships:
  - name: demos
    using:
      foreign_key_constraint_on:
        column: match_id
        table:
          name: match_map_demos
          schema: public
  - name: match_maps
    using:
      foreign_key_constraint_on:
        column: match_id
        table:
          name: match_maps
          schema: public
  - name: player_assists
    using:
      foreign_key_constraint_on:
        column: match_id
        table:
          name: player_assists
          schema: public
  - name: player_damages
    using:
      foreign_key_constraint_on:
        column: match_id
        table:
          name: player_damages
          schema: public
  - name: player_flashes
    using:
      foreign_key_constraint_on:
        column: match_id
        table:
          name: player_flashes
          schema: public
  - name: player_kills
    using:
      foreign_key_constraint_on:
        column: match_id
        table:
          name: player_kills
          schema: public
  - name: player_objectives
    using:
      foreign_key_constraint_on:
        column: match_id
        table:
          name: player_objectives
          schema: public
  - name: player_unused_utilities
    using:
      foreign_key_constraint_on:
        column: match_id
        table:
          name: player_unused_utility
          schema: public
  - name: player_utility
    using:
      foreign_key_constraint_on:
        column: match_id
        table:
          name: player_utility
          schema: public
  - name: tournament_brackets
    using:
      foreign_key_constraint_on:
        column: match_id
        table:
          name: tournament_brackets
          schema: public
  - name: veto_picks
    using:
      foreign_key_constraint_on:
        column: match_id
        table:
          name: match_veto_picks
          schema: public
computed_fields:
  - name: can_assign_map
    definition:
      function:
        name: is_match_organizer
        schema: public
      session_argument: hasura_session
  - name: connection_link
    definition:
      function:
        name: get_match_connection_link
        schema: public
      session_argument: hasura_session
  - name: connection_string
    definition:
      function:
        name: get_match_connection_string
        schema: public
      session_argument: hasura_session
  - name: current_match_map_id
    definition:
      function:
        name: get_current_match_map
        schema: public
  - name: is_captain
    definition:
      function:
        name: is_captain
        schema: public
      session_argument: hasura_session
  - name: is_coach
    definition:
      function:
        name: is_coach
        schema: public
      session_argument: hasura_session
  - name: is_match_server_available
    definition:
      function:
        name: is_match_server_available
        schema: public
  - name: is_organizer
    definition:
      function:
        name: is_match_organizer
        schema: public
      session_argument: hasura_session
  - name: max_players_per_lineup
    definition:
      function:
        name: match_max_players_per_lineup
        schema: public
  - name: min_players_per_lineup
    definition:
      function:
        name: match_min_players_per_lineup
        schema: public
  - name: server_type
    definition:
      function:
        name: get_match_server_type
        schema: public
  - name: teams
    definition:
      function:
        name: get_match_teams
        schema: public
  - name: tv_connection_link
    definition:
      function:
        name: get_match_tv_connection_link
        schema: public
      session_argument: hasura_session
  - name: tv_connection_string
    definition:
      function:
        name: get_match_tv_connection_string
        schema: public
      session_argument: hasura_session
  - name: veto_picking_lineup_id
    definition:
      function:
        name: get_veto_picking_lineup_id
        schema: public
  - name: veto_type
    definition:
      function:
        name: get_veto_type
        schema: public
insert_permissions:
  - role: user
    permission:
      check: {}
      set:
        organizer_steam_id: x-hasura-user-id
      columns:
        - label
        - match_options_id
        - scheduled_at
        - server_id
    comment: ""
select_permissions:
  - role: user
    permission:
      columns:
        - created_at
        - id
        - label
        - lineup_1_id
        - lineup_2_id
        - match_options_id
        - organizer_steam_id
        - scheduled_at
        - server_id
        - status
        - winning_lineup_id
      computed_fields:
        - can_assign_map
        - connection_link
        - connection_string
        - current_match_map_id
        - is_captain
        - is_coach
        - is_match_server_available
        - is_organizer
        - max_players_per_lineup
        - min_players_per_lineup
        - server_type
        - tv_connection_link
        - tv_connection_string
        - veto_picking_lineup_id
        - veto_type
      filter: {}
      allow_aggregations: true
    comment: ""
update_permissions:
  - role: administrator
    permission:
      columns:
        - label
        - organizer_steam_id
        - scheduled_at
        - server_id
        - winning_lineup_id
      filter: {}
      check: null
    comment: ""
  - role: match_organizer
    permission:
      columns:
        - label
        - organizer_steam_id
        - scheduled_at
        - server_id
        - winning_lineup_id
      filter:
        tournament_brackets:
          id:
            _is_null: true
      check:
        tournament_brackets:
          id:
            _is_null: true
    comment: ""
  - role: tournament_organizer
    permission:
      columns:
        - label
        - organizer_steam_id
        - scheduled_at
        - server_id
        - winning_lineup_id
      filter:
        tournament_brackets:
          id:
            _is_null: false
      check:
        tournament_brackets:
          id:
            _is_null: false
    comment: ""
  - role: user
    permission:
      columns:
        - label
        - organizer_steam_id
        - scheduled_at
        - server_id
        - winning_lineup_id
      filter:
        organizer_steam_id:
          _eq: x-hasura-user-id
      check:
        organizer_steam_id:
          _eq: x-hasura-user-id
    comment: ""
delete_permissions:
  - role: user
    permission:
      filter:
        organizer_steam_id:
          _eq: x-hasura-user-id
    comment: ""
event_triggers:
  - name: match_events
    definition:
      delete:
        columns: '*'
      enable_manual: true
      insert:
        columns: '*'
      update:
        columns: '*'
    retry_conf:
      interval_sec: 10
      num_retries: 6
      timeout_sec: 60
    webhook: '{{HASURA_GRAPHQL_EVENT_HOOK}}'
